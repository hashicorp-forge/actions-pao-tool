#!/usr/bin/env bats

# Need 1.7.0 for run() to accept flags
# Note: need 1.7.0 for bats_require_minimum_version definition.
bats_require_minimum_version 1.7.0

# Rename bats' `run` function as `bats_run`.
# This must be in the current shell, so it cannot be within a bats setup* function.
eval "$(echo -n 'bats_run()' ; declare -f run | tail -n +2)"

readonly MAX_LENGTH=40

setup() {
    bats_load_library bats-support
    bats_load_library bats-assert

    source "xlate"
}

# Check for disallowed strings; case-insensitive
assert_string_absent() {
    local str="${1@L}" data="${2@L}"
    case "$data" in
        *${str}*) fail "found '${str}'" ;;
        *) return 0 ;;
    esac
}

# bats test_tags=group:translation
@test "all products translation" {
    local product
    for product in "${ALL_PRODUCTS[@]}" ; do
        output="$(xlate "$product")"
        #echo "xlate: [$product] -> [$output]" 1>&3
        echo "$output" 1>&3
        assert_string_absent "terraform-enterprise" "$output"
        assert_string_absent "fips" "$output"
        assert_string_absent "hsm" "$output"
        assert_string_absent "+ent" "$output"
    done
}

@test "all products length" {
    local product
    for product in "${ALL_PRODUCTS[@]}" ; do
        output="$(xlate "$product")"
        assert [ "${#output}" -le $MAX_LENGTH ]
    done
}

ALL_PRODUCTS=(
    "boundary_0.19.0+ent_darwin_amd64.zip"
    "boundary_0.19.0+ent_darwin_arm64.zip"
    "boundary_0.19.0+ent_freebsd_386.zip"
    "boundary_0.19.0+ent_freebsd_amd64.zip"
    "boundary_0.19.0+ent_freebsd_arm.zip"
    "boundary_0.19.0+ent_linux_386.zip"
    "boundary_0.19.0+ent_linux_amd64.zip"
    "boundary_0.19.0+ent_linux_arm.zip"
    "boundary_0.19.0+ent_linux_arm64.zip"
    "boundary_0.19.0+ent_netbsd_386.zip"
    "boundary_0.19.0+ent_netbsd_amd64.zip"
    "boundary_0.19.0+ent_netbsd_arm.zip"
    "boundary_0.19.0+ent_openbsd_386.zip"
    "boundary_0.19.0+ent_openbsd_amd64.zip"
    "boundary_0.19.0+ent_openbsd_arm.zip"
    "boundary_0.19.0+ent_solaris_amd64.zip"
    "boundary_0.19.0+ent_windows_386.zip"
    "boundary_0.19.0+ent_windows_amd64.zip"
    "consul-enterprise-1.18.9+ent-1.aarch64.rpm"
    "consul-enterprise-1.18.9+ent-1.armv7hl.rpm"
    "consul-enterprise-1.18.9+ent-1.i386.rpm"
    "consul-enterprise-1.18.9+ent-1.x86_64.rpm"
    "consul-enterprise-1.20.4+ent-1.aarch64.rpm"
    "consul-enterprise-1.20.4+ent-1.armv7hl.rpm"
    "consul-enterprise-1.20.4+ent-1.i386.rpm"
    "consul-enterprise-1.20.4+ent-1.x86_64.rpm"
    "consul-enterprise-fips-1.18.9+ent.fips1402-1.aarch64.rpm"
    "consul-enterprise-fips-1.18.9+ent.fips1402-1.x86_64.rpm"
    "consul-enterprise-fips-1.20.4+ent.fips1402-1.aarch64.rpm"
    "consul-enterprise-fips-1.20.4+ent.fips1402-1.x86_64.rpm"
    "consul-enterprise-fips_1.18.9+ent.fips1402-1_amd64.deb"
    "consul-enterprise-fips_1.18.9+ent.fips1402-1_arm64.deb"
    "consul-enterprise-fips_1.20.4+ent.fips1402-1_amd64.deb"
    "consul-enterprise-fips_1.20.4+ent.fips1402-1_arm64.deb"
    "consul-enterprise_1.18.9+ent-1_amd64.deb"
    "consul-enterprise_1.18.9+ent-1_arm64.deb"
    "consul-enterprise_1.18.9+ent-1_armhf.deb"
    "consul-enterprise_1.18.9+ent-1_i386.deb"
    "consul-enterprise_1.20.4+ent-1_amd64.deb"
    "consul-enterprise_1.20.4+ent-1_arm64.deb"
    "consul-enterprise_1.20.4+ent-1_armhf.deb"
    "consul-enterprise_1.20.4+ent-1_i386.deb"
    "consul-enterprise_default-fips_linux_amd64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default-fips_linux_amd64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default-fips_linux_amd64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default-fips_linux_amd64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_default-fips_linux_arm64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default-fips_linux_arm64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default-fips_linux_arm64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default-fips_linux_arm64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_default_linux_386_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default_linux_386_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default_linux_386_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default_linux_386_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_default_linux_amd64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default_linux_amd64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default_linux_amd64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default_linux_amd64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_default_linux_arm64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default_linux_arm64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default_linux_arm64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default_linux_arm64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_default_linux_arm_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_default_linux_arm_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_default_linux_arm_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_default_linux_arm_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.redhat.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.18.9+ent.fips1402_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.redhat.tar"
    "consul-enterprise_ubi-fips_linux_amd64_1.20.4+ent.fips1402_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul-enterprise_ubi_linux_amd64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.dev.tar"
    "consul-enterprise_ubi_linux_amd64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.redhat.tar"
    "consul-enterprise_ubi_linux_amd64_1.18.9+ent_7efa21df50f8431d258b8f737d5562115f690939.docker.tar"
    "consul-enterprise_ubi_linux_amd64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.dev.tar"
    "consul-enterprise_ubi_linux_amd64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.redhat.tar"
    "consul-enterprise_ubi_linux_amd64_1.20.4+ent_10a6e3b21e909284b07122e7d0ac124069839ec7.docker.tar"
    "consul_1.18.9+ent.fips1402_linux_amd64.zip"
    "consul_1.18.9+ent.fips1402_linux_arm64.zip"
    "consul_1.18.9+ent.fips1402_windows_amd64.zip"
    "consul_1.18.9+ent_darwin_amd64.zip"
    "consul_1.18.9+ent_darwin_arm64.zip"
    "consul_1.18.9+ent_freebsd_386.zip"
    "consul_1.18.9+ent_freebsd_amd64.zip"
    "consul_1.18.9+ent_linux_386.zip"
    "consul_1.18.9+ent_linux_amd64.zip"
    "consul_1.18.9+ent_linux_arm.zip"
    "consul_1.18.9+ent_linux_arm64.zip"
    "consul_1.18.9+ent_linux_s390x.zip"
    "consul_1.18.9+ent_solaris_amd64.zip"
    "consul_1.18.9+ent_windows_386.zip"
    "consul_1.18.9+ent_windows_amd64.zip"
    "consul_1.20.4+ent.fips1402_linux_amd64.zip"
    "consul_1.20.4+ent.fips1402_linux_arm64.zip"
    "consul_1.20.4+ent.fips1402_windows_amd64.zip"
    "consul_1.20.4+ent_darwin_amd64.zip"
    "consul_1.20.4+ent_darwin_arm64.zip"
    "consul_1.20.4+ent_freebsd_386.zip"
    "consul_1.20.4+ent_freebsd_amd64.zip"
    "consul_1.20.4+ent_linux_386.zip"
    "consul_1.20.4+ent_linux_amd64.zip"
    "consul_1.20.4+ent_linux_arm.zip"
    "consul_1.20.4+ent_linux_arm64.zip"
    "consul_1.20.4+ent_linux_s390x.zip"
    "consul_1.20.4+ent_solaris_amd64.zip"
    "consul_1.20.4+ent_windows_386.zip"
    "consul_1.20.4+ent_windows_amd64.zip"
    "nomad-enterprise-1.9.6+ent-1.aarch64.rpm"
    "nomad-enterprise-1.9.6+ent-1.s390x.rpm"
    "nomad-enterprise-1.9.6+ent-1.x86_64.rpm"
    "nomad-enterprise_1.9.6+ent-1_amd64.deb"
    "nomad-enterprise_1.9.6+ent-1_arm64.deb"
    "nomad-enterprise_1.9.6+ent-1_s390x.deb"
    "nomad-enterprise_release_linux_amd64_1.9.6+ent_72d6b89a8ef93fd8d5bdd5dc4b0ac875f3748c89.docker.dev.tar"
    "nomad-enterprise_release_linux_amd64_1.9.6+ent_72d6b89a8ef93fd8d5bdd5dc4b0ac875f3748c89.docker.tar"
    "nomad-enterprise_release_linux_arm64_1.9.6+ent_72d6b89a8ef93fd8d5bdd5dc4b0ac875f3748c89.docker.dev.tar"
    "nomad-enterprise_release_linux_arm64_1.9.6+ent_72d6b89a8ef93fd8d5bdd5dc4b0ac875f3748c89.docker.tar"
    "nomad_1.9.6+ent.musl_linux_amd64.zip"
    "nomad_1.9.6+ent_darwin_amd64.zip"
    "nomad_1.9.6+ent_darwin_arm64.zip"
    "nomad_1.9.6+ent_linux_amd64.zip"
    "nomad_1.9.6+ent_linux_arm64.zip"
    "nomad_1.9.6+ent_linux_s390x.zip"
    "nomad_1.9.6+ent_windows_amd64.zip"
    "terraform-enterprise_production_linux_amd64_v202502-1-faf700d_497970b25ec833d5b7b00e827a1b229df03eac37.docker.tar"
    "vault-enterprise-1.18.4+ent-1.aarch64.rpm"
    "vault-enterprise-1.18.4+ent-1.armv7hl.rpm"
    "vault-enterprise-1.18.4+ent-1.i386.rpm"
    "vault-enterprise-1.18.4+ent-1.s390x.rpm"
    "vault-enterprise-1.18.4+ent-1.x86_64.rpm"
    "vault-enterprise-fips1402-1.18.4+ent-1.aarch64.rpm"
    "vault-enterprise-fips1402-1.18.4+ent-1.x86_64.rpm"
    "vault-enterprise-fips1402_1.18.4+ent-1_amd64.deb"
    "vault-enterprise-fips1402_1.18.4+ent-1_arm64.deb"
    "vault-enterprise-hsm-1.18.4+ent-1.aarch64.rpm"
    "vault-enterprise-hsm-1.18.4+ent-1.x86_64.rpm"
    "vault-enterprise-hsm-fips1402-1.18.4+ent-1.aarch64.rpm"
    "vault-enterprise-hsm-fips1402-1.18.4+ent-1.x86_64.rpm"
    "vault-enterprise-hsm-fips1402_1.18.4+ent-1_amd64.deb"
    "vault-enterprise-hsm-fips1402_1.18.4+ent-1_arm64.deb"
    "vault-enterprise-hsm_1.18.4+ent-1_amd64.deb"
    "vault-enterprise-hsm_1.18.4+ent-1_arm64.deb"
    "vault-enterprise_1.18.4+ent-1_amd64.deb"
    "vault-enterprise_1.18.4+ent-1_arm64.deb"
    "vault-enterprise_1.18.4+ent-1_armhf.deb"
    "vault-enterprise_1.18.4+ent-1_i386.deb"
    "vault-enterprise_1.18.4+ent-1_s390x.deb"
    "vault-enterprise_default_linux_386_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_default_linux_amd64_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_default_linux_arm64_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_default_linux_arm_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-fips_linux_amd64_1.18.4+ent.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-fips_linux_amd64_1.18.4+ent.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-fips_linux_arm64_1.18.4+ent.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-fips_linux_arm64_1.18.4+ent.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-hsm-fips_linux_amd64_1.18.4+ent.hsm.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-hsm-fips_linux_amd64_1.18.4+ent.hsm.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-hsm-fips_linux_arm64_1.18.4+ent.hsm.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-hsm-fips_linux_arm64_1.18.4+ent.hsm.fips1402_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-hsm_linux_amd64_1.18.4+ent.hsm_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-hsm_linux_amd64_1.18.4+ent.hsm_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi-hsm_linux_arm64_1.18.4+ent.hsm_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi-hsm_linux_arm64_1.18.4+ent.hsm_a7b6963bc01c138f0b8e24163597817234b8d517.docker.tar"
    "vault-enterprise_ubi_linux_amd64_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault-enterprise_ubi_linux_arm64_1.18.4+ent_a7b6963bc01c138f0b8e24163597817234b8d517.docker.redhat.tar"
    "vault_1.18.4+ent.fips1402_linux_amd64.zip"
    "vault_1.18.4+ent.fips1402_linux_arm64.zip"
    "vault_1.18.4+ent.hsm.fips1402_linux_amd64.zip"
    "vault_1.18.4+ent.hsm.fips1402_linux_arm64.zip"
    "vault_1.18.4+ent.hsm_linux_amd64.zip"
    "vault_1.18.4+ent.hsm_linux_arm64.zip"
    "vault_1.18.4+ent_darwin_amd64.zip"
    "vault_1.18.4+ent_darwin_arm64.zip"
    "vault_1.18.4+ent_freebsd_386.zip"
    "vault_1.18.4+ent_freebsd_amd64.zip"
    "vault_1.18.4+ent_freebsd_arm.zip"
    "vault_1.18.4+ent_linux_386.zip"
    "vault_1.18.4+ent_linux_amd64.zip"
    "vault_1.18.4+ent_linux_arm.zip"
    "vault_1.18.4+ent_linux_arm64.zip"
    "vault_1.18.4+ent_linux_s390x.zip"
    "vault_1.18.4+ent_netbsd_386.zip"
    "vault_1.18.4+ent_netbsd_amd64.zip"
    "vault_1.18.4+ent_netbsd_arm.zip"
    "vault_1.18.4+ent_openbsd_386.zip"
    "vault_1.18.4+ent_openbsd_amd64.zip"
    "vault_1.18.4+ent_openbsd_arm.zip"
    "vault_1.18.4+ent_solaris_amd64.zip"
    "vault_1.18.4+ent_windows_386.zip"
    "vault_1.18.4+ent_windows_amd64.zip"
    "vault_default_linux_386_1.18.4+ent.tar"
    "vault_default_linux_amd64_1.18.4+ent.tar"
    "vault_default_linux_arm64_1.18.4+ent.tar"
    "vault_default_linux_arm_1.18.4+ent.tar"
    "vault_ubi_linux_amd64_1.18.4+ent.fips1402.tar"
    "vault_ubi_linux_amd64_1.18.4+ent.hsm.fips1402.tar"
    "vault_ubi_linux_amd64_1.18.4+ent.hsm.tar"
    "vault_ubi_linux_arm64_1.18.4+ent.fips1402.tar"
    "vault_ubi_linux_arm64_1.18.4+ent.hsm.fips1402.tar"
    "vault_ubi_linux_arm64_1.18.4+ent.hsm.tar"
    "vault_1.19.5+ent.hsm.fips1403_linux_amd64.zip"
    "vault_1.19.5+ent.hsm.fips1403_linux_arm64.zip"
    "vault_1.19.5+ent.fips1403_linux_amd64.zip"
    "vault_1.19.5+ent.fips1403_linux_arm64.zip"
    "vault_1.19.5+ent.hsm.fips1403_linux_amd64.zip"
    "vault_1.19.5+ent.hsm.fips1403_linux_arm64.zip"
)
